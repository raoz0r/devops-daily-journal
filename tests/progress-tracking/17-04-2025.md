---
tags:
  - docker
  - docker-compose
  - grafana
  - prometheus
  - loki
  - promtail
  - cadvisor
  - node-exporter
  - rclone
  - github
  - keepassxc
  - n8n
  - llama
  - monitoring
  - devops
---

# 17.04.2025

#docker #docker-compose #grafana #prometheus #loki #promtail #cadvisor #node-exporter #rclone #github #keepassxc #n8n #llama #monitoring #devops <!-- markdownlint-disable MD018 -->

## 🌟 Daily Goals

- ✅ Chrome is not asking for password anymore to access the keyring
- ✅ Install Docker Engine
- ✅ Install Docker Compose
- ✅ Installed KeepassXC to manage my passwords
- ✅ Installed n8n AI Starter Kit with Llama
- ✅ Installed Grafana
- ✅ Move and set up n8n self-hosted AI starter kit from Google Drive to local storage
- ✅ Finalize and stabilize rclone mount using systemd
- ✅ Deploy full monitoring stack: Grafana + Prometheus + cAdvisor + Node Exporter + Loki + Promtail
- ✅ Validate logs and metrics inside Grafana
- ✅ Create centralized observability foundation

---

## ⚙️ Infrastructure Overview

### ✅ Deployed stack via Docker Compose

- grafana + grafana-db (PostgreSQL backend)
- prometheus (scraping cAdvisor & node-exporter)
- cadvisor (container metrics)
- node-exporter (host metrics)
- loki (log database)
- promtail (log shipper)

### ✅ Data sources in Grafana

- Prometheus (metrics)
- Loki (logs)

### ✅ Validated dashboards

- Docker container metrics (ID: 193)
- Log viewer via Loki `{job="varlogs"}` queries

## 🔗 Key Resources

[https://grafana.com/docs/loki/latest/setup/install/docker/](https://grafana.com/docs/loki/latest/setup/install/docker/)
[https://easylinuxtipsproject.blogspot.com/p/tips-1.html#ID15](https://easylinuxtipsproject.blogspot.com/p/tips-1.html#ID15) - Disable Keyring Password Google Chrome
[https://docs.docker.com/engine/install/ubuntu/](https://docs.docker.com/engine/install/ubuntu/)
[https://docs.docker.com/compose/install/linux/#install-using-the-repository](https://docs.docker.com/compose/install/linux/#install-using-the-repository)
[https://keepassxc.org/docs/](https://keepassxc.org/docs/)
[https://github.com/n8n-io/self-hosted-ai-starter-kit](https://github.com/n8n-io/self-hosted-ai-starter-kit)
[https://grafana.com/docs/grafana/latest/setup-grafana/configure-docker/](https://grafana.com/docs/grafana/latest/setup-grafana/configure-docker/)
[https://prometheus.io/docs/guides/node-exporter/](https://prometheus.io/docs/guides/node-exporter/)

---

## 🧩 Step-by-Step Reference Guide

### 🛠 Git + GitHub SSH Setup Guide

This guide documents the full setup process for pushing this project to GitHub using SSH authentication.

---

### ✅ 1. Initialize Git

Inside the project directory:

```bash
git init
```

---

### 🔐 2. Generate an SSH Key (if not already created)

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

- Press `Enter` to accept the default path (`~/.ssh/id_ed25519`)
- Add a passphrase if you want extra security (optional)

---

### 🔄 3. Start SSH Agent and Add Your Key

```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519
```

---

### 🧾 4. Configure Git Identity

Set your name and email for commits:

```bash
git config --global user.name "Your Name"
git config --global user.email "your_email@example.com"
```

> Use `--global` to apply system-wide. Omit to set per-project.

---

### 🔗 5. Authenticate via GitHub CLI (Recommended)

```bash
gh auth login
```

- Choose: `GitHub.com`
- Protocol: `SSH`
- Select your public key (e.g., `/home/ghost/.ssh/id_ed25519.pub`)
- Complete login in your browser

---

### 🐙 6. Create GitHub Repository (with Push)

```bash
gh repo create grafana-stack --public --source=. --remote=origin --push
```

> If the remote isn't added automatically:

```bash
git remote add origin git@github.com:<your-username>/grafana-stack.git
```

---

### 📦 7. First Commit & Push

```bash
git add .
git commit -m "Initial commit - Grafana Monitoring Stack"
git branch -M main
git push -u origin main
```

---

### 🌍 8. Open Repo in Browser (Optional)

```bash
gh repo view --web
```

---

🧠 **Pro Tip:** Use this setup across multiple projects—just reuse the SSH key!

### 🔐 Disable GNOME Keyring Password Prompt (for Chrome)

```bash
rm -v ~/.local/share/keyrings/*.keyring
```

> Press Enter.

Then:

1. The next time you’re prompted for a keyring password,
2. Leave the field blank,
3. Click **Continue** and then **Continue** again to confirm unsafe storage.
4. The keyring password will be disabled permanently.

---

### 🐳 Uninstall Docker Engine

```bash
sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
sudo rm /etc/apt/sources.list.d/docker.list
sudo rm /etc/apt/keyrings/docker.asc
```

---

### 🔐 KeePassXC Password Manager Setup

- Database stored in Google Drive > resources > KeePass Folder
- Chrome extension installed for autocomplete

---

### 🤖 Install n8n AI Starter Kit with LLaMA

Follow steps from: [https://github.com/n8n-io/self-hosted-ai-starter-kit](https://github.com/n8n-io/self-hosted-ai-starter-kit)

---

### 📊 Docker Compose Setup for Grafana, Postgres, cAdvisor & Prometheus

[GitHub Repository – Full Stack Setup](https://github.com/raoz0r/grafana-stack)

---

### 🔧 Rclone Permission Issues

- Mounted Google Drive with systemd but got `Permission denied`
- Found mismatch between rclone gid=1000 and user gid=984 (docker)
- ✅ Fixed by aligning group ID or adding user to the correct group
- Also got `Transport endpoint is not connected`
- ✅ Resolved by running `fusermount -u` before remount

---

### 🔧 cAdvisor vs Grafana Docker Dashboard

- Dashboard ID 193 not showing container metrics
- ✅ Verified Prometheus queries:
  - `container_memory_usage_bytes`
  - `container_cpu_usage_seconds_total`
- Likely label mismatch or scrape delay
- ⏳ Waited a few minutes → metrics appeared

---

### 🔧 Loki Crash Loop

- Loki container failed with config parse errors: `final_sleep`, `max_transfer_retries`, `shared_store`, etc.
- ✅ Fixed by removing deprecated fields
- ✅ Updated config to schema v12
- ✅ Added `common.path_prefix` and `allow_structured_metadata: false`

---

### 🔧 Promtail No Logs

- Loki working but no logs in Grafana
- Found incorrect glob in config:

  ```yaml
  __path__: /var/log/*.log
  ```

- ✅ Fixed to:

  ```yaml
  __path__: /var/log/**/*.log
  ```

- ✅ Logs appeared after config reload

---

### 🔧 Grafana Couldn't Connect to Loki

- Error: Unable to connect with Loki
- ✅ Root cause: Loki was crashing due to bad config
- ✅ Fixed Loki → Grafana connected via `http://loki:3100`

---

## ❗ Troubleshooting

- 🔴 **Grafana is not showing the stats after adding Loki and Promtail**

  To check if Prometheus is receiving data:

  **From cAdvisor:**
  - `container_memory_usage_bytes`
  - `container_cpu_usage_seconds_total` **From node-exporter:**
  - `node_cpu_seconds_total`

---

## 🗓️ Next Day Preview

- 🟡 Serve your own static site via Nginx
- 🟡 Try volumes and bind mounts in Docker
- 🟡 Automate backups with a script
- 🟡 Possibly try watchtower or portainer if you're going wild
