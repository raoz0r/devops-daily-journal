---
tags:
  - systemd
  - rclone
  - google-drive
  - ext4
  - backup
  - vscode
  - keyboard-layout
  - devops
---

# 16.04.2025

#systemd #rclone #google-drive #ext4  #backup #vscode #keyboard-layout #devops <!-- markdownlint-disable MD018 -->

## üåü Daily Goals

-

---

## üõ†Ô∏è Work Sessions

### üîß Session 1

## Tasks Completed

- !#done Set auto-mount for Google Drive via systemd
- !#done Identified VS Code's sandbox limitations with FUSE mounts
- !#done Fixed wrong keyboard layout
- !#done Reformatted second SSD to ext4
- !#done Installed rclone and configured Google Drive mount

## Solutions

- !#solution Used [https://github.com/raelgc/win\_us\_intl](https://github.com/raelgc/win_us_intl) to solve the wrong keyboard layout
- !#solution Followed rclone instructions to be able to access Google Drive
- !#solution Via terminal type `code <folder>` to be able to use VS Code in Google Drive folders

## Troubleshooting

- !#error Compose file not applied due to GTK\_IM\_MODULE override
- !#error Second SSD auto-mounted with wrong perms via GNOME
- !#error VS Code's sandboxed environment sometimes doesn‚Äôt trust FUSE mounts

---

## üìä Progress Metrics

| Completed Tasks                              | Time Spent |
| -------------------------------------------- | ---------- |
| Identified VS Code sandbox issue with FUSE   |     10h       |
| Set auto-mount for Google Drive via systemd  |            |
| Fixed wrong keyboard layout                  |            |
| Reformatted second SSD to ext4               |            |
| Installed rclone and configured Google Drive |            |

---

## üîó Key Resources

- !#reference [https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html](https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html) - Descreve op√ß√µes de configura√ß√£o comuns a todas as unidades systemd (`[Unit]`, `[Install]`), como depend√™ncias e comportamento no boot.

- !#reference [https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html](https://www.freedesktop.org/software/systemd/man/latest/systemd.service.html) - Documenta configura√ß√µes espec√≠ficas de unidades `.service`, incluindo como configurar comandos, restart e permiss√µes.

- !#reference [https://wiki.archlinux.org/title/Systemd](https://wiki.archlinux.org/title/Systemd) - Guia pr√°tico e aprofundado sobre o uso do systemd, com foco em sua aplica√ß√£o no Arch Linux, √∫til tamb√©m para outras distros.

- !#reference [https://rclone.org/drive/#making-your-own-client-id](https://rclone.org/drive/#making-your-own-client-id)

- !#reference [https://github.com/raelgc/win\_us\_intl](https://github.com/raelgc/win_us_intl)

---

## üóìÔ∏è Next Day Preview

- !#pending Install Docker Engine
- !#pending Install Docker Compose
- !#pending Install n8n
- !#pending Setup and run n8n
- !#pending Serve your own static site via Nginx
- !#pending Try volumes and bind mounts in Docker
- !#pending Automate backups with a script
- !#pending Possibly try watchtower or portainer if you're going wild

---

## üßΩ Step-by-Step Reference Guide

### üîß Fix Wrong Keyboard Layout (Cedilla Issue)

1. Installed improved Compose layout:

   ```bash
   sudo apt-add-repository -y ppa:rael-gc/utils
   sudo apt update
   sudo apt install win-us-intl
   ```

2. Disabled GTK keyboard module override:

   ```bash
   gsettings set org.gnome.settings-daemon.plugins.xsettings disabled-gtk-modules '["keyboard"]'
   ```

3. Set input method:

   ```bash
   im-config -n uim
   ```

4. Logged out and back in

---

### üìÄ Format and Mount Second SSD (ext4)

1. Unmounted old NTFS partition:

   ```bash
   sudo umount /dev/sdb1
   ```

2. Reformatted to ext4:

   ```bash
   sudo mkfs.ext4 /dev/sdb1 -L Storage
   ```

3. Retrieved UUID:

   ```bash
   sudo blkid /dev/sdb1
   ```

4. Updated `/etc/fstab`:

   ```fstab
   UUID=<YOUR_UUID> /mnt/storage ext4 defaults 0 2
   ```

5. Created mount point and mounted drive:

   ```bash
   sudo mkdir -p /mnt/storage
   sudo mount -a
   ```

6. Adjusted permissions:

   ```bash
   sudo chown ghost:ghost /mnt/storage
   ```

---

### ‚òÅÔ∏è Mount Google Drive with Rclone

1. Installed rclone:

   ```bash
   sudo apt install rclone
   rclone config
   ```

2. Created custom OAuth credentials via Google Cloud Console
3. Configured remote with `rclone config` using custom `client_id` and `client_secret`
4. Tested connection:

   ```bash
   rclone lsd google_drive:
   ```

5. Created mount folder and mounted Google Drive:

   ```bash
   mkdir -p /mnt/storage/GoogleDrive
   rclone mount google_drive: /mnt/storage/GoogleDrive --vfs-cache-mode writes &
   ```

6. Created systemd service to auto-mount Google Drive on boot:

   ```bash
   sudo vim /etc/systemd/system/rclone-gdrive.service
   ```

   Content:

   ```ini
   [Unit]
   Description=Mount Google Drive using rclone
   After=network-online.target
   Wants=network-online.target

   [Service]
   Type=simple
   ExecStart=/usr/bin/rclone mount google_drive: /mnt/storage/GoogleDrive \
       --vfs-cache-mode writes \
       --dir-cache-time 12h \
       --poll-interval 15s \
       --timeout 1m \
       --umask 002 \
       --uid=1000 --gid=1000
   ExecStop=/bin/fusermount -u /mnt/storage/GoogleDrive
   Restart=on-failure
   RestartSec=10
   User=ghost

   [Install]
   WantedBy=default.target
   ```

   Then enable and start the service:

   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable rclone-gdrive
   sudo systemctl start rclone-gdrive
   ```

   To debug or monitor the service:

   ```bash
   journalctl -u rclone-gdrive -f


## üß© System Backup Setup ‚Äì April 17, 2025

> Full system backup with clean exclusions, stored under `/mnt/storage/backups/`  
> Purpose: Snapshot the current working system (vscode, keyboard, rclone, etc.)

---

## üõ†Ô∏è Backup Script (Full System Snapshot)

Created a script to archive the full system minus volatile/runtime paths.

### üìÑ Step 1: Create backup script

```bash
touch ~/bin/backup-system.sh
chmod +x ~/bin/backup-system.sh
```

Edit it and paste:

```bash
#!/bin/bash

DATE=$(date +%F-%H%M)
DEST="/mnt/storage/backups"
FILENAME="full-system-backup-$DATE.tar.gz"
ARCHIVE="$DEST/$FILENAME"

# Ensure backup destination exists
mkdir -p "$DEST"

echo "üì¶ Creating system snapshot at $ARCHIVE..."

sudo tar --exclude="$DEST" \
         --exclude="/proc" \
         --exclude="/sys" \
         --exclude="/dev" \
         --exclude="/tmp" \
         --exclude="/run" \
         --exclude="/mnt/storage" \
         --exclude="/media" \
         --exclude="/swapfile" \
         -czpvf "$ARCHIVE" /

echo "‚úÖ Backup complete!"
```

---

## ‚úÖ What This Backup Includes

‚úîÔ∏è `/home/ghost`  
‚úîÔ∏è `/etc`, including keyboard fixes and system services  
‚úîÔ∏è `~/.XCompose`  
‚úîÔ∏è Installed `.deb` packages  
‚úîÔ∏è rclone config  
‚úîÔ∏è All manually installed apps (e.g. VS Code, Spotify, Docker once installed)  
‚úîÔ∏è Keyboard layout fixes from `win-us-intl` PPA  
‚úîÔ∏è PPA repo configs from `/etc/apt/sources.list.d/`

---

## ‚ùå What Is Excluded

| Path                | Reason                          |
|---------------------|----------------------------------|
| `/proc`, `/sys`, `/dev`, `/tmp`, `/run` | Runtime/virtual filesystems |
| `/mnt/storage`      | Personal files not required in snapshot |
| `/media`            | Temporary mounts (e.g. USBs)     |
| `/swapfile`         | Automatically recreated by system |

---

## üì¶ How to Run It

```bash
backup-system.sh
```

Or explicitly:

```bash
~/bin/backup-system.sh
```

---

## üß™ To Restore (Advanced Recovery)

From a live USB or recovery shell:

```bash
mount /dev/sdX1 /mnt
tar -xpf full-system-backup-YYYY-MM-DD-HHMM.tar.gz -C /mnt
chroot /mnt
update-initramfs -u
grub-install /dev/sdX
reboot
```

---

## üß† Notes

- Backup file saved under: `/mnt/storage/backups/full-system-backup-YYYY-MM-DD-HHMM.tar.gz`
- You can optionally sync to Google Drive using `rclone copy`
- Add `dpkg --get-selections > ~/Documents/package-list.txt` if you want package snapshots
- Add `/etc/apt/sources.list.d/` and `/etc/apt/trusted.gpg.d/` to future-proof PPAs

---
